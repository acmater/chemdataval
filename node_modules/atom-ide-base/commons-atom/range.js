"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.isPositionInRange = exports.matchRegexEndingAt = exports.wordAtPositionFromBuffer = exports.getWordFromCursorOrSelection = exports.getWordFromMouseEvent = exports.trimRange = exports.wordAtPosition = void 0;
const atom_1 = require("atom");
const assert_1 = __importDefault(require("assert"));
function wordAtPosition(editor, position, wordRegex) {
    let wordRegex_;
    if (wordRegex instanceof RegExp) {
        wordRegex_ = wordRegex;
    }
    else {
        const nonWordChars = editor.getNonWordCharacters(position);
        const escaped = nonWordChars.replace(/[-/\\^$*+?.()|[\]{}]/g, "\\$&");
        let r = `^[\t ]*$|[^\\s${escaped}]+`;
        if (wordRegex == null || wordRegex.includeNonWordCharacters) {
            r += `|[${escaped}]+`;
        }
        wordRegex_ = new RegExp(r, "g");
    }
    return wordAtPositionFromBuffer(editor.getBuffer(), position, wordRegex_);
}
exports.wordAtPosition = wordAtPosition;
function trimRange(editor, rangeToTrim, stopRegex = /\S/) {
    const buffer = editor.getBuffer();
    let { start, end } = rangeToTrim;
    buffer.scanInRange(stopRegex, rangeToTrim, ({ range, stop }) => {
        start = range.start;
        stop();
    });
    buffer.backwardsScanInRange(stopRegex, rangeToTrim, ({ range, stop }) => {
        end = range.end;
        stop();
    });
    return new atom_1.Range(start, end);
}
exports.trimRange = trimRange;
function getSingleWordAtPosition(editor, position) {
    const match = wordAtPosition(editor, position);
    if (match == null || match.wordMatch.length !== 1) {
        return null;
    }
    return match.wordMatch[0];
}
function getWordFromMouseEvent(editor, event) {
    const component = editor.getElement().component;
    assert_1.default(component);
    const point = component.screenPositionForMouseEvent(event);
    return getSingleWordAtPosition(editor, point);
}
exports.getWordFromMouseEvent = getWordFromMouseEvent;
function getWordFromCursorOrSelection(editor) {
    const selection = editor.getSelectedText();
    if (selection && selection.length > 0) {
        return selection;
    }
    const point = editor.getCursorScreenPosition();
    return getSingleWordAtPosition(editor, point);
}
exports.getWordFromCursorOrSelection = getWordFromCursorOrSelection;
function wordAtPositionFromBuffer(buffer, position, wordRegex) {
    const { row, column } = position;
    const rowRange = buffer.rangeForRow(row);
    let matchData;
    buffer.scanInRange(wordRegex, rowRange, (data) => {
        const { range } = data;
        if (range.start.isLessThanOrEqual(position) && range.end.isGreaterThan(position)) {
            matchData = data;
        }
        if (range.end.column > column) {
            data.stop();
        }
    });
    if (matchData) {
        return {
            wordMatch: matchData.match,
            range: matchData.range,
        };
    }
    else {
        return null;
    }
}
exports.wordAtPositionFromBuffer = wordAtPositionFromBuffer;
function matchRegexEndingAt(buffer, endPosition, regex) {
    const line = buffer.getTextInRange([[endPosition.row, 0], endPosition]);
    const match = regex.exec(line);
    return match == null ? null : match[0];
}
exports.matchRegexEndingAt = matchRegexEndingAt;
function isPositionInRange(position, range) {
    return Array.isArray(range) ? range.some((r) => r.containsPoint(position)) : range.containsPoint(position);
}
exports.isPositionInRange = isPositionInRange;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMtY29tbW9ucy1hdG9tL3JhbmdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLCtCQUFnRjtBQUNoRixvREFBOEI7QUFROUIsU0FBZ0IsY0FBYyxDQUM1QixNQUFrQixFQUNsQixRQUFlLEVBQ2YsU0FBMEQ7SUFFMUQsSUFBSSxVQUFVLENBQUE7SUFDZCxJQUFJLFNBQVMsWUFBWSxNQUFNLEVBQUU7UUFDL0IsVUFBVSxHQUFHLFNBQVMsQ0FBQTtLQUN2QjtTQUFNO1FBTUwsTUFBTSxZQUFZLEdBQVcsTUFBTSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQ2xFLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsdUJBQXVCLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFLckUsSUFBSSxDQUFDLEdBQUcsaUJBQWlCLE9BQU8sSUFBSSxDQUFBO1FBQ3BDLElBQUksU0FBUyxJQUFJLElBQUksSUFBSSxTQUFTLENBQUMsd0JBQXdCLEVBQUU7WUFDM0QsQ0FBQyxJQUFJLEtBQUssT0FBTyxJQUFJLENBQUE7U0FDdEI7UUFDRCxVQUFVLEdBQUcsSUFBSSxNQUFNLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFBO0tBQ2hDO0lBQ0QsT0FBTyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLEVBQUUsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFBO0FBQzNFLENBQUM7QUEzQkQsd0NBMkJDO0FBYUQsU0FBZ0IsU0FBUyxDQUFDLE1BQWtCLEVBQUUsV0FBa0IsRUFBRSxZQUFvQixJQUFJO0lBQ3hGLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQTtJQUNqQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxHQUFHLFdBQVcsQ0FBQTtJQUNoQyxNQUFNLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFO1FBQzdELEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFBO1FBQ25CLElBQUksRUFBRSxDQUFBO0lBQ1IsQ0FBQyxDQUFDLENBQUE7SUFDRixNQUFNLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFLFdBQVcsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUU7UUFDdEUsR0FBRyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUE7UUFDZixJQUFJLEVBQUUsQ0FBQTtJQUNSLENBQUMsQ0FBQyxDQUFBO0lBQ0YsT0FBTyxJQUFJLFlBQUssQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUE7QUFDOUIsQ0FBQztBQVpELDhCQVlDO0FBRUQsU0FBUyx1QkFBdUIsQ0FBQyxNQUFrQixFQUFFLFFBQWU7SUFDbEUsTUFBTSxLQUFLLEdBQUcsY0FBYyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUU5QyxJQUFJLEtBQUssSUFBSSxJQUFJLElBQUksS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQ2pELE9BQU8sSUFBSSxDQUFBO0tBQ1o7SUFFRCxPQUFPLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDM0IsQ0FBQztBQVVELFNBQWdCLHFCQUFxQixDQUFDLE1BQWtCLEVBQUUsS0FBaUI7SUFNekUsTUFBTSxTQUFTLEdBQXdCLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUE7SUFDcEUsZ0JBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQTtJQUVwQixNQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsMkJBQTJCLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDMUQsT0FBTyx1QkFBdUIsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFDL0MsQ0FBQztBQVhELHNEQVdDO0FBVUQsU0FBZ0IsNEJBQTRCLENBQUMsTUFBa0I7SUFDN0QsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFBO0lBQzFDLElBQUksU0FBUyxJQUFJLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1FBQ3JDLE9BQU8sU0FBUyxDQUFBO0tBQ2pCO0lBR0QsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLHVCQUF1QixFQUFFLENBQUE7SUFDOUMsT0FBTyx1QkFBdUIsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFDL0MsQ0FBQztBQVRELG9FQVNDO0FBRUQsU0FBZ0Isd0JBQXdCLENBQ3RDLE1BQWtCLEVBQ2xCLFFBQWUsRUFDZixTQUFpQjtJQUVqQixNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQTtJQUNoQyxNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3hDLElBQUksU0FBd0QsQ0FBQTtJQUU1RCxNQUFNLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRTtRQUMvQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFBO1FBQ3RCLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNoRixTQUFTLEdBQUcsSUFBSSxDQUFBO1NBQ2pCO1FBRUQsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxNQUFNLEVBQUU7WUFDN0IsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFBO1NBQ1o7SUFDSCxDQUFDLENBQUMsQ0FBQTtJQUVGLElBQUksU0FBUyxFQUFFO1FBQ2IsT0FBTztZQUNMLFNBQVMsRUFBRSxTQUFTLENBQUMsS0FBSztZQUMxQixLQUFLLEVBQUUsU0FBUyxDQUFDLEtBQUs7U0FDdkIsQ0FBQTtLQUNGO1NBQU07UUFDTCxPQUFPLElBQUksQ0FBQTtLQUNaO0FBQ0gsQ0FBQztBQTVCRCw0REE0QkM7QUFLRCxTQUFnQixrQkFBa0IsQ0FBQyxNQUFrQixFQUFFLFdBQWtCLEVBQUUsS0FBYTtJQUN0RixNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUE7SUFDdkUsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM5QixPQUFPLEtBQUssSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ3hDLENBQUM7QUFKRCxnREFJQztBQUVELFNBQWdCLGlCQUFpQixDQUFDLFFBQWUsRUFBRSxLQUEyQjtJQUM1RSxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtBQUM1RyxDQUFDO0FBRkQsOENBRUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXh0RWRpdG9yLCBUZXh0RWRpdG9yQ29tcG9uZW50LCBUZXh0QnVmZmVyLCBSYW5nZSwgUG9pbnQgfSBmcm9tIFwiYXRvbVwiXG5pbXBvcnQgaW52YXJpYW50IGZyb20gXCJhc3NlcnRcIlxuXG4vKipcbiAqIEZpbmRzIHRoZSB3b3JkIGF0IHRoZSBwb3NpdGlvbi4gWW91IGNhbiBlaXRoZXIgcHJvdmlkZSBhIHdvcmQgcmVnZXggeW91cnNlbGYsXG4gKiBvciBoYXZlIEF0b20gdXNlIHRoZSB3b3JkIHJlZ2V4IGluIGZvcmNlIGF0IHRoZSBzY29wZXMgYXQgdGhhdCBwb3NpdGlvbixcbiAqIGluIHdoaWNoIGNhc2UgaXQgdXNlcyB0aGUgb3B0aW9uYWwgaW5jbHVkZU5vbldvcmRDaGFyYWN0ZXJzLCBkZWZhdWx0IHRydWUuXG4gKiAoSSBrbm93IHRoYXQncyBhIHdlaXJkIGRlZmF1bHQgYnV0IGl0IGZvbGxvd3MgQXRvbSdzIGNvbnZlbnRpb24uLi4pXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3b3JkQXRQb3NpdGlvbihcbiAgZWRpdG9yOiBUZXh0RWRpdG9yLFxuICBwb3NpdGlvbjogUG9pbnQsXG4gIHdvcmRSZWdleD86IFJlZ0V4cCB8IHsgaW5jbHVkZU5vbldvcmRDaGFyYWN0ZXJzOiBib29sZWFuIH1cbik6IHsgd29yZE1hdGNoOiBBcnJheTxzdHJpbmc+OyByYW5nZTogUmFuZ2UgfSB8IG51bGwge1xuICBsZXQgd29yZFJlZ2V4X1xuICBpZiAod29yZFJlZ2V4IGluc3RhbmNlb2YgUmVnRXhwKSB7XG4gICAgd29yZFJlZ2V4XyA9IHdvcmRSZWdleFxuICB9IGVsc2Uge1xuICAgIC8vIFdoYXQgaXMgdGhlIHdvcmQgcmVnZXggYXNzb2NpYXRlZCB3aXRoIHRoZSBwb3NpdGlvbj8gV2UnZCBsaWtlIHRvIHVzZVxuICAgIC8vIEN1cnNvci53b3JkUmVnRXhwLCBleGNlcHQgdGhhdCBmdW5jdGlvbiBnZXRzIHRoZSByZWdleCBhc3NvY2lhdGVkXG4gICAgLy8gd2l0aCB0aGUgZWRpdG9yJ3MgY3VycmVudCBjdXJzb3Igd2hpbGUgd2Ugd2FudCB0aGUgcmVnZXggYXNzb2NpYXRlZCB3aXRoXG4gICAgLy8gdGhlIHNwZWNpZmljIHBvc2l0aW9uLiBTbyB3ZSByZS1pbXBsZW1lbnQgaXQgb3Vyc2VsdmVzLi4uXG4gICAgLy8gQHRzLWlnbm9yZTogaHR0cHM6Ly9naXRodWIuY29tL2F0b20vYXRvbS9ibG9iL2FhM2MzNGJlZGIzNjFlMDlhNTA2OGRjZTk2MjBiNDYwYTIwY2EzZmIvc3JjL3RleHQtZWRpdG9yLmpzI0w1MDMyXG4gICAgY29uc3Qgbm9uV29yZENoYXJzOiBzdHJpbmcgPSBlZGl0b3IuZ2V0Tm9uV29yZENoYXJhY3RlcnMocG9zaXRpb24pXG4gICAgY29uc3QgZXNjYXBlZCA9IG5vbldvcmRDaGFycy5yZXBsYWNlKC9bLS9cXFxcXiQqKz8uKCl8W1xcXXt9XS9nLCBcIlxcXFwkJlwiKVxuICAgIC8vIFdlIGNvcGllZCB0aGlzIGVzY2FwaW5nIHJlZ2V4IGZyb20gQ3Vyc29yLndvcmRSZWdleHAsIHJhdGhlciB0aGFuXG4gICAgLy8gdXNpbmcgdGhlIGxpYnJhcnkgZnVuY3Rpb24gJ2VzY2FwZVN0cmluZ1JlZ0V4cCcuIFRoYXQncyBiZWNhdXNlIHRoZVxuICAgIC8vIGxpYnJhcnkgZnVuY3Rpb24gZG9lc24ndCBlc2NhcGUgdGhlIGh5cGhlbiBjaGFyYWN0ZXIgYW5kIHNvIGlzXG4gICAgLy8gdW5zdWl0YWJsZSBmb3IgdXNlIGluc2lkZSBhIHJhbmdlLlxuICAgIGxldCByID0gYF5bXFx0IF0qJHxbXlxcXFxzJHtlc2NhcGVkfV0rYFxuICAgIGlmICh3b3JkUmVnZXggPT0gbnVsbCB8fCB3b3JkUmVnZXguaW5jbHVkZU5vbldvcmRDaGFyYWN0ZXJzKSB7XG4gICAgICByICs9IGB8WyR7ZXNjYXBlZH1dK2BcbiAgICB9XG4gICAgd29yZFJlZ2V4XyA9IG5ldyBSZWdFeHAociwgXCJnXCIpXG4gIH1cbiAgcmV0dXJuIHdvcmRBdFBvc2l0aW9uRnJvbUJ1ZmZlcihlZGl0b3IuZ2V0QnVmZmVyKCksIHBvc2l0aW9uLCB3b3JkUmVnZXhfKVxufVxuXG4vKipcbiAqIEdldHMgdGhlIHRyaW1tZWQgcmFuZ2UgZnJvbSBhIGdpdmVuIHJhbmdlLCBpLmUuIG1vdmVzIHRoZSBzdGFydCBhbmQgZW5kIHBvaW50c1xuICogdG8gdGhlIGZpcnN0IGFuZCBsYXN0IG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMgKG9yIHNwZWNpZmllZCByZWdleClcbiAqIHdpdGhpbiB0aGUgcmFuZ2UgcmVzcGVjdGl2ZWx5LlxuICpcbiAqIEBwYXJhbSBlZGl0b3IgICAgICAgdGhlIGVkaXRvciBjb250YWluaW5nIHRoZSByYW5nZVxuICogQHBhcmFtIHJhbmdlVG9UcmltICB0aGUgcmFuZ2UgdG8gdHJpbVxuICogQHBhcmFtIHN0b3BSZWdleCAgICBzdG9wIHRyaW1taW5nIHdoZW4gdGhlIGZpcnN0IG1hdGNoIGlzIGZvdW5kIGZvciB0aGlzIHJlZ2V4LFxuICogICBkZWZhdWx0cyB0byBmaXJzdCBub24td2hpdGVzcGFjZSBjaGFyYWN0ZXJcbiAqIEByZXR1cm4gUmFuZ2UgIHRoZSB0cmltbWVkIHJhbmdlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0cmltUmFuZ2UoZWRpdG9yOiBUZXh0RWRpdG9yLCByYW5nZVRvVHJpbTogUmFuZ2UsIHN0b3BSZWdleDogUmVnRXhwID0gL1xcUy8pOiBSYW5nZSB7XG4gIGNvbnN0IGJ1ZmZlciA9IGVkaXRvci5nZXRCdWZmZXIoKVxuICBsZXQgeyBzdGFydCwgZW5kIH0gPSByYW5nZVRvVHJpbVxuICBidWZmZXIuc2NhbkluUmFuZ2Uoc3RvcFJlZ2V4LCByYW5nZVRvVHJpbSwgKHsgcmFuZ2UsIHN0b3AgfSkgPT4ge1xuICAgIHN0YXJ0ID0gcmFuZ2Uuc3RhcnRcbiAgICBzdG9wKClcbiAgfSlcbiAgYnVmZmVyLmJhY2t3YXJkc1NjYW5JblJhbmdlKHN0b3BSZWdleCwgcmFuZ2VUb1RyaW0sICh7IHJhbmdlLCBzdG9wIH0pID0+IHtcbiAgICBlbmQgPSByYW5nZS5lbmRcbiAgICBzdG9wKClcbiAgfSlcbiAgcmV0dXJuIG5ldyBSYW5nZShzdGFydCwgZW5kKVxufVxuXG5mdW5jdGlvbiBnZXRTaW5nbGVXb3JkQXRQb3NpdGlvbihlZGl0b3I6IFRleHRFZGl0b3IsIHBvc2l0aW9uOiBQb2ludCk6IHN0cmluZyB8IG51bGwge1xuICBjb25zdCBtYXRjaCA9IHdvcmRBdFBvc2l0aW9uKGVkaXRvciwgcG9zaXRpb24pXG4gIC8vIFdlIHNob3VsZCBvbmx5IHJlY2VpdmUgYSBzaW5nbGUgaWRlbnRpZmllciBmcm9tIGEgc2luZ2xlIHBvaW50LlxuICBpZiAobWF0Y2ggPT0gbnVsbCB8fCBtYXRjaC53b3JkTWF0Y2gubGVuZ3RoICE9PSAxKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIHJldHVybiBtYXRjaC53b3JkTWF0Y2hbMF1cbn1cblxuLyoqXG4gKiBHZXRzIHRoZSB3b3JkIGJlaW5nIHJpZ2h0LWNsaWNrZWQgb24gaW4gYSBNb3VzZUV2ZW50LiBBIGdvb2QgdXNlIGNhc2UgZm9yXG4gKiB0aGlzIGlzIHBlcmZvcm1pbmcgYW4gYWN0aW9uIG9uIGEgd29yZCBmcm9tIGEgY29udGV4dCBtZW51LlxuICpcbiAqIEBwYXJhbSBlZGl0b3IgIHRoZSBlZGl0b3IgY29udGFpbmluZyB0aGUgd29yZCB3aGVyZSB0aGUgTW91c2VFdmVudCBvY2N1cnJlZFxuICogICBmcm9tXG4gKiBAcGFyYW0gZXZlbnQgICB0aGUgTW91c2VFdmVudCBjb250YWluaW5nIHRoZSBzY3JlZW4gcG9zaXRpb24gb2YgdGhlIGNsaWNrXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRXb3JkRnJvbU1vdXNlRXZlbnQoZWRpdG9yOiBUZXh0RWRpdG9yLCBldmVudDogTW91c2VFdmVudCk6IHN0cmluZyB8IG51bGwge1xuICAvLyBXZSBjYW4ndCBpbW1lZGlhdGVseSBnZXQgdGhlIGlkZW50aWZpZXIgcmlnaHQtY2xpY2tlZCBvbiBmcm9tXG4gIC8vIHRoZSBNb3VzZUV2ZW50LiBVc2luZyBpdHMgdGFyZ2V0IGVsZW1lbnQgY29udGVudCB3b3VsZCB3b3JrIGluXG4gIC8vIHNvbWUgY2FzZXMgYnV0IHdvdWxkbid0IHdvcmsgaWYgdGhlcmUgd2FzIGFkZGl0aW9uYWwgY29udGVudFxuICAvLyBpbiB0aGUgc2FtZSBlbGVtZW50LCBzdWNoIGFzIGluIGEgY29tbWVudC5cbiAgLy8gQHRzLWlnbm9yZTogaHR0cHM6Ly9naXRodWIuY29tL2F0b20vYXRvbS9ibG9iL2FhM2MzNGJlZGIzNjFlMDlhNTA2OGRjZTk2MjBiNDYwYTIwY2EzZmIvc3JjL3RleHQtZWRpdG9yLmpzI0w1MDc1XG4gIGNvbnN0IGNvbXBvbmVudDogVGV4dEVkaXRvckNvbXBvbmVudCA9IGVkaXRvci5nZXRFbGVtZW50KCkuY29tcG9uZW50XG4gIGludmFyaWFudChjb21wb25lbnQpXG4gIC8vIFRoaXMgc29sdXRpb24gZG9lc24ndCBmZWVsIGlkZWFsIGJ1dCBpdCBpcyB0aGUgd2F5IGh5cGVyY2xpY2sgZG9lcyBpdC5cbiAgY29uc3QgcG9pbnQgPSBjb21wb25lbnQuc2NyZWVuUG9zaXRpb25Gb3JNb3VzZUV2ZW50KGV2ZW50KVxuICByZXR1cm4gZ2V0U2luZ2xlV29yZEF0UG9zaXRpb24oZWRpdG9yLCBwb2ludClcbn1cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBnZXQgYSB3b3JkIGZyb20gdGhlIGxhc3Qgc2VsZWN0aW9uIG9yIGN1cnNvci4gQSBnb29kIHVzZSBjYXNlIGZvclxuICogdGhpcyBpcyBwZXJmb3JtaW5nIGFuIGFjdGlvbiBvbiBhbiAnYWN0aXZlJyB3b3JkIGFmdGVyIGEgY29tbWFuZCBpcyB0cmlnZ2VyZWRcbiAqIHZpYSBhIGtleWJpbmRpbmcuXG4gKlxuICogQHBhcmFtIGVkaXRvciAgdGhlIGVkaXRvciBjb250YWluaW5nIHRoZSAnYWN0aXZlJyB3b3JkIHdoZW4gdGhlIGtleWJpbmRpbmcgaXNcbiAqICAgdHJpZ2dlcmVkXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRXb3JkRnJvbUN1cnNvck9yU2VsZWN0aW9uKGVkaXRvcjogVGV4dEVkaXRvcik6IHN0cmluZyB8IG51bGwge1xuICBjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3IuZ2V0U2VsZWN0ZWRUZXh0KClcbiAgaWYgKHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24ubGVuZ3RoID4gMCkge1xuICAgIHJldHVybiBzZWxlY3Rpb25cbiAgfVxuXG4gIC8vIFRoZXJlIHdhcyBubyBzZWxlY3Rpb24gc28gd2UgY2FuIGdvIGFoZWFkIGFuZCB0cnkgdGhlIGN1cnNvciBwb3NpdGlvbi5cbiAgY29uc3QgcG9pbnQgPSBlZGl0b3IuZ2V0Q3Vyc29yU2NyZWVuUG9zaXRpb24oKVxuICByZXR1cm4gZ2V0U2luZ2xlV29yZEF0UG9zaXRpb24oZWRpdG9yLCBwb2ludClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdvcmRBdFBvc2l0aW9uRnJvbUJ1ZmZlcihcbiAgYnVmZmVyOiBUZXh0QnVmZmVyLFxuICBwb3NpdGlvbjogUG9pbnQsXG4gIHdvcmRSZWdleDogUmVnRXhwXG4pOiB7IHdvcmRNYXRjaDogQXJyYXk8c3RyaW5nPjsgcmFuZ2U6IFJhbmdlIH0gfCBudWxsIHtcbiAgY29uc3QgeyByb3csIGNvbHVtbiB9ID0gcG9zaXRpb25cbiAgY29uc3Qgcm93UmFuZ2UgPSBidWZmZXIucmFuZ2VGb3JSb3cocm93KVxuICBsZXQgbWF0Y2hEYXRhOiB7IG1hdGNoOiBBcnJheTxzdHJpbmc+OyByYW5nZTogUmFuZ2UgfSB8IG51bGxcbiAgLy8gRXh0cmFjdCB0aGUgZXhwcmVzc2lvbiBmcm9tIHRoZSByb3cgdGV4dC5cbiAgYnVmZmVyLnNjYW5JblJhbmdlKHdvcmRSZWdleCwgcm93UmFuZ2UsIChkYXRhKSA9PiB7XG4gICAgY29uc3QgeyByYW5nZSB9ID0gZGF0YVxuICAgIGlmIChyYW5nZS5zdGFydC5pc0xlc3NUaGFuT3JFcXVhbChwb3NpdGlvbikgJiYgcmFuZ2UuZW5kLmlzR3JlYXRlclRoYW4ocG9zaXRpb24pKSB7XG4gICAgICBtYXRjaERhdGEgPSBkYXRhXG4gICAgfVxuICAgIC8vIFN0b3AgdGhlIHNjYW4gaWYgdGhlIHNjYW5uZXIgaGFzIHBhc3NlZCBvdXIgcG9zaXRpb24uXG4gICAgaWYgKHJhbmdlLmVuZC5jb2x1bW4gPiBjb2x1bW4pIHtcbiAgICAgIGRhdGEuc3RvcCgpXG4gICAgfVxuICB9KVxuICAvLyBAdHMtaWdub3JlIChpdCBpcyBhc3NpZ25lZCBhYm92ZSlcbiAgaWYgKG1hdGNoRGF0YSkge1xuICAgIHJldHVybiB7XG4gICAgICB3b3JkTWF0Y2g6IG1hdGNoRGF0YS5tYXRjaCxcbiAgICAgIHJhbmdlOiBtYXRjaERhdGEucmFuZ2UsXG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJldHVybiBudWxsXG4gIH1cbn1cblxuLy8gTWF0Y2hlcyBhIHJlZ2V4IG9uIHRoZSB0ZXh0IG9mIHRoZSBsaW5lIGVuZGluZyBhdCBlbmRQb3NpdGlvbi5cbi8vIHJlZ2V4IHNob3VsZCBlbmQgd2l0aCBhICckJy5cbi8vIFVzZWZ1bCBmb3IgYXV0b2NvbXBsZXRlLlxuZXhwb3J0IGZ1bmN0aW9uIG1hdGNoUmVnZXhFbmRpbmdBdChidWZmZXI6IFRleHRCdWZmZXIsIGVuZFBvc2l0aW9uOiBQb2ludCwgcmVnZXg6IFJlZ0V4cCk6IHN0cmluZyB8IG51bGwge1xuICBjb25zdCBsaW5lID0gYnVmZmVyLmdldFRleHRJblJhbmdlKFtbZW5kUG9zaXRpb24ucm93LCAwXSwgZW5kUG9zaXRpb25dKVxuICBjb25zdCBtYXRjaCA9IHJlZ2V4LmV4ZWMobGluZSlcbiAgcmV0dXJuIG1hdGNoID09IG51bGwgPyBudWxsIDogbWF0Y2hbMF1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzUG9zaXRpb25JblJhbmdlKHBvc2l0aW9uOiBQb2ludCwgcmFuZ2U6IFJhbmdlIHwgQXJyYXk8UmFuZ2U+KTogYm9vbGVhbiB7XG4gIHJldHVybiBBcnJheS5pc0FycmF5KHJhbmdlKSA/IHJhbmdlLnNvbWUoKHIpID0+IHIuY29udGFpbnNQb2ludChwb3NpdGlvbikpIDogcmFuZ2UuY29udGFpbnNQb2ludChwb3NpdGlvbilcbn1cbiJdfQ==